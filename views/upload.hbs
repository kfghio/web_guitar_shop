<!DOCTYPE html>
<html>
<head>
  <title>File Upload</title>
</head>
<body>

<h1>File Upload</h1>

<form id="uploadForm" enctype="multipart/form-data">
  <div class="upload-box">
    <input type="file" name="file" id="fileInput" accept="image/*" required>
    <p>Select an image file (max 5MB)</p>
  </div>
  <button type="submit">Upload File</button>
</form>

<div id="result" class="result" style="display: none;"></div>

<hr>
<h2>Check Image by URL</h2>
<form id="urlForm">
  <input type="url" id="urlInput" placeholder="Enter image URL" style="width: 100%; padding: 8px;" required>
  <button type="submit" style="margin-top: 10px;">Preview Image</button>
</form>

<div id="uploadedPreview" style="display: none; margin-top: 20px;"></div>

<script>
  document.getElementById('uploadForm').addEventListener('submit', async (e) => {
    e.preventDefault();

    const fileInput = document.getElementById('fileInput');
    const resultDiv = document.getElementById('result');

    if (!fileInput.files.length) {
      showResult('Please select a file first', 'error');
      return;
    }

    const formData = new FormData();
    formData.append('file', fileInput.files[0]);

    try {
      const response = await fetch('/upload', {
        method: 'POST',
        body: formData
      });

      const data = await response.json();
      if (!response.ok || !data.url) {
        throw new Error(data.message || 'Upload failed');
      }

      showResult(`Success! File URL: ${data.url}`, 'success');
      showUploadedFile(data.url);
    } catch (error) {
      showResult(`Error: ${error.message}`, 'error');
    }
  });

  document.getElementById('urlForm').addEventListener('submit', (e) => {
    e.preventDefault();

    const url = document.getElementById('urlInput').value.trim();
    if (!url) return;

    showUploadedFile(url);
  });

  function showResult(message, type) {
    const resultDiv = document.getElementById('result');
    resultDiv.textContent = message;
    resultDiv.className = `result ${type}`;
    resultDiv.style.display = 'block';
  }

  function showUploadedFile(url) {
    const previewDiv = document.getElementById('uploadedPreview');
    previewDiv.innerHTML = `
      <h3>Image Preview:</h3>
      <a href="${url}" target="_blank">${url}</a>
      <img src="${url}" alt="Preview">
    `;
    previewDiv.style.display = 'block';
  }
</script>

</body>
</html>
